---
title: ä»¿vue-cliæ­å»ºå±äºè‡ªå·±çš„è„šæ‰‹æ¶
layout: post
tags:
  - å‰ç«¯å·¥ç¨‹åŒ–
  - javascript
categories: å‰ç«¯å·¥ç¨‹åŒ–
description: 
cover: /assets/images/bg/5.jpeg
top_img: 
---


## ä»€ä¹ˆæ˜¯è„šæ‰‹æ¶

è„šæ‰‹æ¶å°±æ˜¯ä¸ªå·¥å…·ï¼Œ**æ–¹ä¾¿æˆ‘ä»¬æ–°å»ºé¡¹ç›®ç”¨çš„å·¥å…·**ï¼Œæœ‰äº†è¿™ä¸ªé¡¹ç›®æˆ‘ä»¬å°±èƒ½ç›´æ¥é€šè¿‡å‡ è¡Œå‘½ä»¤, å†é€šè¿‡é…ç½®å°±å¯ä»¥å¼€å‘äº†

æƒ³æƒ³æˆ‘ä»¬å¹³æ—¶å¼€å‘ä¸€ä¸ªæ–°é¡¹ç›®, åŸºæœ¬ä¸Šæˆ‘ä»¬å¯ä»¥ç”¨ git clone url æ¥æ–°å»º(å¤åˆ¶)é¡¹ç›®, æˆ–è€…è¿™ä¸ªå¤åˆ¶ç²˜è´´æ•´ä¸ªæ–‡ä»¶å¤¹

é¦–å…ˆè¦åŸºæœ¬äº†è§£[vue-cli(@vue/cli)](https://cli.vuejs.org/)æ˜¯æ€ä¹ˆå·¥ä½œçš„

è„šæ‰‹æ¶çš„æœ¬è´¨ä¹Ÿæ˜¯ä»è¿œç¨‹ä¸‹è½½ä¸€ä¸ªæ¨¡æ¿æ¥è¿›è¡Œæ–°çš„é¡¹ç›®, æ‰€ä»¥, æœ‰ä»€ä¹ˆä¸åŒå‘¢? å°±é«˜å¤§ä¸Šå•ŠğŸ˜³, å½“ç„¶ä¸æ­¢äºæ­¤, è„šæ‰‹æ¶æ˜¯é«˜çº§ç‰ˆçš„å…‹éš†, å®ƒæä¾›äº†äº¤äº’å¼çš„å‘½ä»¤è®©æˆ‘ä»¬å¯ä»¥åŠ¨æ€çš„æ›´æ”¹æ¨¡æ¿/å…¶ä»–é…ç½®é¡¹, ç„¶åç”¨å‘½ä»¤å°±å¯ä»¥æå®šäº†

## å‰ç½®çŸ¥è¯†

### [commander](https://www.npmjs.com/package/commander)

è¿™æ˜¯ç”¨æ¥ç¼–å†™æŒ‡ä»¤å’Œå¤„ç†å‘½ä»¤è¡Œçš„ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹

```js
const program = require("commander");
// å®šä¹‰æŒ‡ä»¤
program
  .version('0.0.1')
  .command('init', 'Generate a new project from a template')
  .action(() => {
    // å›è°ƒå‡½æ•°
  })
// è§£æå‘½ä»¤è¡Œå‚æ•°
program.parse(process.argv);
```

å›å¿†ä¸€ä¸‹ï¼Œæˆ‘ä»¬æ›¾ç”¨è¿‡çš„ vue init/create å‘½ä»¤å°±æ˜¯è¿™æ ·å£°æ˜çš„ã€‚


### [inquirer](https://www.npmjs.com/package/inquirer)

å¼ºå¤§çš„äº¤äº’å¼å‘½ä»¤è¡Œå·¥å…·ï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹

```js
const inquirer = require('inquirer');
inquirer
  .prompt([
    // ä¸€äº›äº¤äº’å¼çš„é—®é¢˜
  ])
  .then(answers => {
    // å›è°ƒå‡½æ•°ï¼Œanswers å°±æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæ˜¯ä¸ªå¯¹è±¡
  });
```

æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬ç”¨ vue init webpack project-name ä¹‹åæ˜¯ä¸æ˜¯ä¼šæœ‰å‡ ä¸ªäº¤äº’é—®é¢˜ï¼Œé—®ä½ æ–‡ä»¶åå•Šã€ä½œè€…å•Šã€æè¿°å•Šã€è¦ä¸è¦ç”¨ eslint å•Šç­‰ç­‰ä¹‹ç±»çš„ï¼Œå°±æ˜¯ç”¨è¿™ä¸ªæ¥å†™çš„ã€‚


### [chalk](https://www.npmjs.com/package/chalk)

è¿™æ˜¯ç”¨æ¥ä¿®æ”¹æ§åˆ¶å°è¾“å‡ºå†…å®¹æ ·å¼çš„ï¼Œæ¯”å¦‚é¢œè‰²å•Šï¼Œå…·ä½“ç”¨æ³•å¦‚ä¸‹ï¼š

```js
const chalk = require('chalk');
console.log(chalk.green('success'));
console.log(chalk.red('error'));
```


### [ora](https://www.npmjs.com/package/ora)

è¿™æ˜¯ä¸€ä¸ªå¥½çœ‹çš„åŠ è½½ï¼Œå°±æ˜¯ä½ ä¸‹è½½çš„æ—¶å€™ä¼šæœ‰ä¸ªè½¬åœˆåœˆçš„é‚£ç§æ•ˆæœï¼Œç”¨æ³•å¦‚ä¸‹ï¼š

```js
const ora = require('ora')
let spinner = ora('downloading template ...')
spinner.start()
```


### [download-git-repo](https://www.npmjs.com/package/download-git-repo)

çœ‹åå­—å¾ˆæ˜æ˜¾äº†ï¼Œè¿™æ˜¯ç”¨æ¥ä¸‹è½½è¿œç¨‹æ¨¡æ¿çš„ï¼Œæ”¯æŒ GitHubã€ GitLab å’Œ Bitbucket ç­‰ï¼Œç”¨æ³•å¦‚ä¸‹

```js
const download = require('download-git-repo')
download(repository, destination, options, callback)
```

å…¶ä¸­ repository æ˜¯è¿œç¨‹ä»“åº“åœ°å€ï¼›destination æ˜¯å­˜æ”¾ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å†™æ–‡ä»¶åï¼Œé»˜è®¤å°±æ˜¯å½“å‰ç›®å½•ï¼›options æ˜¯ä¸€äº›é€‰é¡¹ï¼Œæ¯”å¦‚ { cloneï¼šboolean } è¡¨ç¤ºç”¨ http download è¿˜æ˜¯ git clone çš„å½¢å¼ä¸‹è½½ã€‚


## é¡¹ç›®æ­å»º

æœ‰äº†ä¸Šé¢çš„çŸ¥è¯†å‚¨å¤‡å, æˆ‘ä»¬å°±æ­£å¼å¼€å§‹æ’¸ä»£ç äº†

1. é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹, å–åä¸º demo-cli
2. åœ¨æ”¹ç›®å½•ä¸‹æ‰§è¡Œ ``npm init -y`` å‘½ä»¤, åœ¨ç”Ÿæˆçš„ package.json æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä¾èµ–å¹¶æ‰§è¡Œ ``npm install`` å®‰è£…, å¦‚ä¸‹

```json
"dependencies": {
  "chalk": "^2.4.2",
  "commander": "^2.19.0",
  "download-git-repo": "^1.1.0",
  "inquirer": "^6.2.2",
  "ora": "^3.2.0"
}
```

3. æ–°å»ºä¸€ä¸ª bin æ–‡ä»¶å¤¹, åœ¨ bin æ–‡ä»¶å¤¹ä¸‹æ–°å»ºä¸€ä¸ªæ— åç¼€åçš„ demo æ–‡ä»¶, å¹¶å†™ä¸Š:

```js
#!/usr/bin/env node
console.log('hello');
```

è¿™ä¸ªæ–‡ä»¶å°±æ˜¯æˆ‘ä»¬æ•´ä¸ªè„šæ‰‹æ¶çš„å…¥å£æ–‡ä»¶, æˆ‘ä»¬ç”¨ ``node ./bin/demo`` è¿è¡Œä¸€ä¸‹, å°±å¯ä»¥çœ‹åˆ°åœ¨æ§åˆ¶å°æ‰“å°å‡º hello

è¿™é‡Œè¦æ³¨æ„å¼€å¤´çš„ #!/usr/bin/env node è¿™ä¸ªè¯­å¥å¿…é¡»åŠ ä¸Šï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©ç³»ç»Ÿçœ‹åˆ°è¿™ä¸€è¡Œçš„æ—¶å€™ï¼Œä¼šæ²¿ç€è¯¥è·¯å¾„å»æŸ¥æ‰¾ node å¹¶æ‰§è¡Œï¼Œä¸»è¦æ˜¯ä¸ºäº†å…¼å®¹ Mac ï¼Œç¡®ä¿å¯æ‰§è¡Œã€‚


### bin ç›®å½•åˆå§‹åŒ–

å½“å‰ï¼Œbin ç›®å½•ä¸‹å°±åªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œå°±æ˜¯å…¥å£æ–‡ä»¶ demoã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å…ˆæ¥ç¼–å†™è¿™ä¸ªæ–‡ä»¶ï¼Œç”±äºå†…å®¹è¾ƒå°‘ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä»£ç ï¼š

```js
#!/usr/bin/env node
const program = require('commander');

program
  .version(require('../package').version, '-V, --version') // å®šä¹‰å½“å‰ç‰ˆæœ¬
  .usage('<command> [options]') // å®šä¹‰ä½¿ç”¨æ–¹æ³•
  .command('add', 'add a new template') // å®šä¹‰å››ä¸ªæŒ‡ä»¤
  .command('delete', 'delete a template')
  .command('list', 'list all the template')
  .command('init', 'generate a new project from a template')

// è§£æå‘½ä»¤è¡Œå‚æ•°
program.parse(process.argv)
```

è¿™ä¸ªæ–‡ä»¶çš„ä¸»è¦ä½œç”¨å°±æ˜¯å®šä¹‰æŒ‡ä»¤ï¼Œç°åœ¨æˆ‘ä»¬ç”¨ node ./bin/demo è¿è¡Œä¸€ä¸‹ï¼Œå°±èƒ½çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š

![commander](../../assets/images/command.jpg)

å½“ç„¶ï¼Œä½ å¯èƒ½ä¼šè§‰å¾—æ¯æ¬¡è¾“å…¥ node ./bin/demo è¿™ä¸ªå‘½ä»¤æœ‰ç‚¹éº»çƒ¦ï¼Œæ²¡å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ package.json é‡Œé¢å†™å…¥å·²ä¸‹å†…å®¹ï¼š

```js
// bin ç”¨æ¥æŒ‡å®šæ¯ä¸ªå‘½ä»¤æ‰€å¯¹åº”çš„å¯æ‰§è¡Œæ–‡ä»¶çš„ä½ç½®
"bin": {
  "demo": "bin/demo"
}
```

ç„¶ååœ¨æ ¹ç›®å½•ä¸‹æ‰§è¡Œ ``npm link``ï¼ˆå°±æ˜¯æŠŠå‘½ä»¤æŒ‚è½½åˆ°å…¨å±€çš„æ„æ€ï¼‰ï¼Œè¿™æ ·æˆ‘ä»¬æ¯æ¬¡åªè¦è¾“å…¥ demoï¼Œå°±å¯ä»¥ç›´æ¥è¿è¡Œäº†ï¼Œso cool

æ˜¯ä¸æ˜¯å¥½åƒæœ‰ç‚¹æ ·å­äº†å‘¢ğŸ˜ğŸ˜ğŸ˜ï¼Œé‚£å°±è®©æˆ‘ä»¬ç»§ç»­å®Œå–„ä¸‹ bin ç›®å½•å§ï¼okï¼Œè®©æˆ‘ä»¬åœ¨ bin ç›®å½•ä¸‹å†æ–°å»ºå››ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«å¯¹åº”ä¸Šé¢çš„å››ä¸ªæŒ‡ä»¤ï¼Œç„¶ååˆ†åˆ«å¤„ç†å››ä¸ªæŒ‡ä»¤è¦åšçš„äº‹æƒ…

åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ package.json é‡Œé¢çš„ bin å†…å®¹ï¼Œå¦‚ä¸‹ï¼š

```json
"bin": {
  "demo": "bin/demo",
  "demo-add": "bin/demo-add",
  "demo-delete": "bin/demo-delete",
  "demo-list": "bin/demo-list",
  "demo-init": "bin/demo-init"
}
```

ç„¶åæ‰§è¡Œ npm unlink è§£ç»‘å…¨å±€å‘½ä»¤ï¼Œå†æ‰§è¡Œ npm link é‡æ–°æŠŠå‘½ä»¤ç»‘å®šåˆ°å…¨å±€

æœ€åé¡ºä¾¿åœ¨æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª template.json æ–‡ä»¶ï¼Œé‡Œé¢çš„å†…å®¹å°±æ˜¯ä¸€ä¸ª {}ã€‚


## ç¼–å†™å…·ä½“æŒ‡ä»¤

å¥½äº†ï¼Œä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œæ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬æ¥å†™ä¸‹å…·ä½“çš„å››ä¸ªæŒ‡ä»¤å§ã€‚

### demo-add

```js
#!/usr/bin/env node

// äº¤äº’å¼å‘½ä»¤è¡Œ
const inquirer = require('inquirer')
// ä¿®æ”¹æ§åˆ¶å°å­—ç¬¦ä¸²çš„æ ·å¼
const chalk = require('chalk')
// node å†…ç½®æ–‡ä»¶æ¨¡å—
const fs = require('fs')
// è¯»å–æ ¹ç›®å½•ä¸‹çš„ template.json
const tplObj = require(`${__dirname}/../template`)

// è‡ªå®šä¹‰äº¤äº’å¼å‘½ä»¤è¡Œçš„é—®é¢˜åŠç®€å•çš„æ ¡éªŒ
let question = [
  {
    name: "name",
    type: 'input',
    message: "è¯·è¾“å…¥æ¨¡æ¿åç§°",
    validate (val) {
      if (val === '') {
        return 'Name is required!'
      } else if (tplObj[val]) {
        return 'Template has already existed!'
      } else {
        return true
      }
    }
  },
  {
    name: "url",
    type: 'input',
    message: "è¯·è¾“å…¥æ¨¡æ¿åœ°å€",
    validate (val) {
      if (val === '') return 'The url is required!'
      return true
    }
  }
]

inquirer
  .prompt(question).then(answers => {
    // answers å°±æ˜¯ç”¨æˆ·è¾“å…¥çš„å†…å®¹ï¼Œæ˜¯ä¸ªå¯¹è±¡
    let { name, url } = answers;
    // è¿‡æ»¤ unicode å­—ç¬¦
    tplObj[name] = url.replace(/[\u0000-\u0019]/g, '')
    // æŠŠæ¨¡æ¿ä¿¡æ¯å†™å…¥ template.json æ–‡ä»¶ä¸­
    fs.writeFile(`${__dirname}/../template.json`, JSON.stringify(tplObj), 'utf-8', err => {
      if (err) console.log(err)
      console.log('\n')
      console.log(chalk.green('Added successfully!\n'))
      console.log(chalk.grey('The latest template list is: \n'))
      console.log(tplObj)
      console.log('\n')
    })
  })
```